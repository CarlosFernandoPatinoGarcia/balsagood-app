-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS public.bloques
(
    id_bloque serial NOT NULL,
    id_orden integer NOT NULL,
    id_cuerpo integer NOT NULL,
    b_largo numeric(10, 4) NOT NULL,
    b_ancho numeric(10, 4) NOT NULL,
    b_alto numeric(10, 4) NOT NULL,
    b_bft_final numeric(12, 4) NOT NULL,
    b_peso_sin_cola numeric(10, 4) NOT NULL,
    b_peso_con_cola numeric(10, 4),
    b_estado character varying(50) COLLATE pg_catalog."default" NOT NULL DEFAULT 'PRESENTADO'::character varying,
    b_codigo bigserial,
    CONSTRAINT bloques_pkey PRIMARY KEY (id_bloque)
);

CREATE TABLE IF NOT EXISTS public.calificaciones_pallet
(
    id_calificacion serial NOT NULL,
    id_pallet integer NOT NULL,
    calificacion_fecha timestamp without time zone,
    calificacion_valor numeric(10, 3) NOT NULL,
    calificador_usuario character varying(50) COLLATE pg_catalog."default",
    calificacion_motivo character varying(255) COLLATE pg_catalog."default",
    CONSTRAINT calificaciones_pallet_pkey PRIMARY KEY (id_calificacion)
);

CREATE TABLE IF NOT EXISTS public.camara
(
    id_camara serial NOT NULL,
    camara_descripcion character varying(200) COLLATE pg_catalog."default" NOT NULL,
    camara_capacidad numeric(10, 2) NOT NULL,
    CONSTRAINT camara_pkey PRIMARY KEY (id_camara)
);

CREATE TABLE IF NOT EXISTS public.consumo_pallets
(
    id_consumo serial NOT NULL,
    id_orden integer NOT NULL,
    id_pallet integer NOT NULL,
    consumo_hora timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT consumo_pallets_pkey PRIMARY KEY (id_consumo)
);

CREATE TABLE IF NOT EXISTS public.cuerpos
(
    id_cuerpo serial NOT NULL,
    cuerpo_ancho_final numeric(10, 4) NOT NULL,
    cuerpo_observacion text COLLATE pg_catalog."default",
    CONSTRAINT cuerpos_pkey PRIMARY KEY (id_cuerpo)
);

CREATE TABLE IF NOT EXISTS public.despachos
(
    id_despacho serial NOT NULL,
    desp_fecha timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
    desp_observacion text COLLATE pg_catalog."default",
    CONSTRAINT despachos_pkey PRIMARY KEY (id_despacho)
);

CREATE TABLE IF NOT EXISTS public.detalle_despacho
(
    id_detalle_despacho serial NOT NULL,
    id_cuerpo integer NOT NULL,
    id_despacho integer NOT NULL,
    CONSTRAINT detalle_despacho_pkey PRIMARY KEY (id_detalle_despacho)
);

CREATE TABLE IF NOT EXISTS public.detalle_secado
(
    id_detalle_secado serial NOT NULL,
    id_pallet integer NOT NULL,
    id_lote integer NOT NULL,
    bft_lote_post_secado numeric(12, 4) NOT NULL,
    CONSTRAINT detalle_secado_pkey PRIMARY KEY (id_detalle_secado)
);

CREATE TABLE IF NOT EXISTS public.lotes_secado
(
    id_lote serial NOT NULL,
    id_camara integer NOT NULL,
    lote_fecha_inicio timestamp without time zone NOT NULL,
    lote_fecha_fin timestamp without time zone,
    lote_observaciones text COLLATE pg_catalog."default",
    CONSTRAINT lotes_secado_pkey PRIMARY KEY (id_lote)
);

CREATE TABLE IF NOT EXISTS public.ordenes_taller
(
    id_orden serial NOT NULL,
    orden_fecha_inicio date NOT NULL,
    orden_fecha_fin date,
    orden_observacion text COLLATE pg_catalog."default",
    CONSTRAINT ordenes_taller_pkey PRIMARY KEY (id_orden)
);

CREATE TABLE IF NOT EXISTS public.pallets_verdes
(
    id_pallet serial NOT NULL,
    id_recepcion integer NOT NULL,
    pallet_numero integer NOT NULL,
    pallet_emplantillador character varying(100) COLLATE pg_catalog."default",
    pallet_cant_plantillas integer NOT NULL,
    pallet_ancho numeric(10, 4) NOT NULL,
    pallet_espesor numeric(10, 4) NOT NULL,
    pallet_largo numeric(10, 4) NOT NULL,
    pallet_ancho_plantilla numeric(10, 4) NOT NULL,
    bft_verde_recibido numeric(12, 4) NOT NULL,
    bft_verde_aceptado numeric(12, 4) NOT NULL,
    pallet_estado character varying(50) COLLATE pg_catalog."default" NOT NULL DEFAULT 'MADERA VERDE'::character varying,
    pallet_observacion text COLLATE pg_catalog."default",
    CONSTRAINT pallets_verdes_pkey PRIMARY KEY (id_pallet)
);

CREATE TABLE IF NOT EXISTS public.proveedor
(
    id_proveedor serial NOT NULL,
    prov_nombre character varying(150) COLLATE pg_catalog."default" NOT NULL,
    CONSTRAINT proveedor_pkey PRIMARY KEY (id_proveedor)
);

CREATE TABLE IF NOT EXISTS public.recepcion
(
    id_recepcion serial NOT NULL,
    id_proveedor integer NOT NULL,
    num_viaje integer NOT NULL,
    fecha_ingreso date NOT NULL DEFAULT CURRENT_DATE,
    CONSTRAINT recepcion_pkey PRIMARY KEY (id_recepcion)
);

ALTER TABLE IF EXISTS public.bloques
    ADD CONSTRAINT fk_bloques_cuerpo FOREIGN KEY (id_cuerpo)
    REFERENCES public.cuerpos (id_cuerpo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE RESTRICT;
CREATE INDEX IF NOT EXISTS idx_bloques_cuerpo
    ON public.bloques(id_cuerpo);


ALTER TABLE IF EXISTS public.bloques
    ADD CONSTRAINT fk_bloques_orden FOREIGN KEY (id_orden)
    REFERENCES public.ordenes_taller (id_orden) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS idx_bloques_orden
    ON public.bloques(id_orden);


ALTER TABLE IF EXISTS public.calificaciones_pallet
    ADD CONSTRAINT fk_calificaciones_pallet FOREIGN KEY (id_pallet)
    REFERENCES public.pallets_verdes (id_pallet) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS idx_calificaciones_id_pallet
    ON public.calificaciones_pallet(id_pallet);


ALTER TABLE IF EXISTS public.consumo_pallets
    ADD CONSTRAINT fk_consumo_orden FOREIGN KEY (id_orden)
    REFERENCES public.ordenes_taller (id_orden) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS idx_consumo_orden
    ON public.consumo_pallets(id_orden);


ALTER TABLE IF EXISTS public.consumo_pallets
    ADD CONSTRAINT fk_consumo_pallet FOREIGN KEY (id_pallet)
    REFERENCES public.pallets_verdes (id_pallet) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE RESTRICT;
CREATE INDEX IF NOT EXISTS idx_consumo_pallet
    ON public.consumo_pallets(id_pallet);


ALTER TABLE IF EXISTS public.detalle_despacho
    ADD CONSTRAINT fk_detalle_despacho_cuerpo FOREIGN KEY (id_cuerpo)
    REFERENCES public.cuerpos (id_cuerpo) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE RESTRICT;
CREATE INDEX IF NOT EXISTS idx_detalle_despacho_cuerpo
    ON public.detalle_despacho(id_cuerpo);


ALTER TABLE IF EXISTS public.detalle_despacho
    ADD CONSTRAINT fk_detalle_despacho_despacho FOREIGN KEY (id_despacho)
    REFERENCES public.despachos (id_despacho) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS idx_detalle_despacho_despacho
    ON public.detalle_despacho(id_despacho);


ALTER TABLE IF EXISTS public.detalle_secado
    ADD CONSTRAINT fk_detalle_secado_lote FOREIGN KEY (id_lote)
    REFERENCES public.lotes_secado (id_lote) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS idx_detalle_secado_lote
    ON public.detalle_secado(id_lote);


ALTER TABLE IF EXISTS public.detalle_secado
    ADD CONSTRAINT fk_detalle_secado_pallet FOREIGN KEY (id_pallet)
    REFERENCES public.pallets_verdes (id_pallet) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE RESTRICT;
CREATE INDEX IF NOT EXISTS idx_detalle_secado_pallet
    ON public.detalle_secado(id_pallet);


ALTER TABLE IF EXISTS public.lotes_secado
    ADD CONSTRAINT fk_lotes_camara FOREIGN KEY (id_camara)
    REFERENCES public.camara (id_camara) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE RESTRICT;
CREATE INDEX IF NOT EXISTS idx_lotes_camara
    ON public.lotes_secado(id_camara);


ALTER TABLE IF EXISTS public.pallets_verdes
    ADD CONSTRAINT fk_pallets_recepcion FOREIGN KEY (id_recepcion)
    REFERENCES public.recepcion (id_recepcion) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE CASCADE;
CREATE INDEX IF NOT EXISTS idx_pallets_recepcion
    ON public.pallets_verdes(id_recepcion);


ALTER TABLE IF EXISTS public.recepcion
    ADD CONSTRAINT fk_recepcion_proveedor FOREIGN KEY (id_proveedor)
    REFERENCES public.proveedor (id_proveedor) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE RESTRICT;
CREATE INDEX IF NOT EXISTS idx_recepcion_proveedor
    ON public.recepcion(id_proveedor);

END;